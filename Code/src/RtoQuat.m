function q = RtoQuat(R)

q = zeros([4 1]);

if R(2,2) > -R(3,3) && R(1,1) > -R(2,2) && R(1,1) > -R(3,3)
    den = sqrt(1 + R(1,1) + R(2,2) + R(3,3));
    q = 0.5.*[den;
        (R(2,3) - R(3,2))/den;
        (R(3,1) - R(1,3))/den;
        (R(1,2) - R(2,1))/den];
elseif R(2,2) < -R(3,3) && R(1,1) > R(2,2) && R(1,1) > R(3,3)
    den = sqrt(1 + R(1,1) - R(2,2) - R(3,3));
    q = 0.5.*[(R(2,3) - R(3,2))/den;
        den;
        (R(1,2) + R(2,1))/den;
        (R(3,1) + R(1,3))/den];
elseif R(2,2) > R(3,3) && R(1,1) < R(2,2) && R(1,1) < -R(3,3)
    den = sqrt(1 - R(1,1) + R(2,2) - R(3,3));
    q = 0.5.*[(R(3,1) - R(1,3))/den;
        (R(1,2) + R(2,1))/den;
        den;
        (R(2,3) + R(3,2))/den];
elseif R(2,2) < R(3,3) && R(1,1) < -R(2,2) && R(1,1) < R(3,3)
    den = sqrt(1 - R(1,1) - R(2,2) + R(3,3));
    q = 0.5.*[(R(1,2) - R(2,1))/den;
        (R(3,1) + R(1,3))/den;
        (R(2,3) + R(3,2))/den;
        den];
end

